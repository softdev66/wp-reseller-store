!function(a){"use strict";var b={init:function(){var a=parseInt(Cookies.get(rstore.cookies.cartCount),10);b.updateCount(a),a>0&&b.api("get",{},function(a){b.updateCount(a)})},api:function(b,c,d,e){var f={method:b,url:rstore.urls.cart_api,dataType:"json",contentType:"application/json",data:JSON.stringify(c),crossDomain:!0,xhrFields:{withCredentials:!0}};d=a.isFunction(d)?d:function(){},e=a.isFunction(e)?e:function(){},a.ajax(f).done(d).fail(e)},addItem:function(a,c,d,e){var f={items:[{id:a,quantity:c>0?c:1}]};b.api("post",f,function(a){b.updateCount(a),d&&(window.location.href=rstore.urls.cart),e&&!d&&b.addItemSuccess(e)},function(a){window.console.log(a),e&&b.addItemError(e,a)})},updateCount:function(b){b=void 0!==b.cartCount?b.cartCount:b,b=b?parseInt(b,10):0,Cookies.set(rstore.cookies.cartCount,b,{expires:new Date((new Date).getTime()+rstore.cookies.ttl),path:"/"}),a(".rstore-cart-count").text(b),a(".widget.rstore-cart").each(function(){a(this).toggle(!a(this).hasClass("hide-empty")||b>0)})},addItemButton:function(c){c.preventDefault();var d=a(this),e=d.closest("form"),f=d.attr("data-id"),g=parseInt(d.attr("data-quantity"),10),h="true"===d.attr("data-redirect");return!d.attr("data-loading")&&(d.attr("data-loading","true"),e.find(".rstore-message").empty(),e.find(".rstore-loading").show(),void b.addItem(f,g,h,e))},addItemSuccess:function(a){var b='<span class="dashicons dashicons-yes rstore-success"></span> <a href="'+rstore.urls.cart+'">'+rstore.i18n.view_cart+"</a>";a.find(".rstore-add-to-cart").removeAttr("data-loading"),a.find(".rstore-loading").hide(),a.find(".rstore-message").html(b)},addItemError:function(a,b){var c=rstore.i18n.error;void 0!==b.error.statusCode&&void 0!==b.error.name&&void 0!==b.error.message&&(c=b.error.statusCode+" "+b.error.name+": "+b.error.message);var d='<span class="dashicons dashicons-warning rstore-error"></span> '+c;a.find(".rstore-add-to-cart").removeAttr("data-loading"),a.find(".rstore-loading").hide(),a.find(".rstore-message").html(d)},addItemParam:function(){var a=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==a&&rstore.product.id&&(b.addItem(rstore.product.id,parseInt(a[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}};a(document).ready(function(a){b.addItemParam(),b.init(),a(document).on("click",".rstore-add-to-cart",b.addItemButton)})}(jQuery);